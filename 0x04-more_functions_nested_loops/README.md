more function and nested loop